# GitHub Actions specific optimizations
# This file should be used as an override with the base test compose file

services:
  database:
    # More aggressive optimizations for CI speed
    command: >
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --skip-character-set-client-handshake
      --innodb-buffer-pool-size=512M
      --innodb-redo-log-capacity=128M  
      --innodb-flush-log-at-trx-commit=0
      --innodb-flush-method=O_DIRECT
      --sync-binlog=0
      --skip-name-resolve
      --query-cache-type=0
      --tmp-table-size=128M
      --max-heap-table-size=128M

  webserver:
    # Use specific user for GitHub Actions
    user: "1001:121"  # GitHub Actions runner user
    deploy:
      resources:
        limits:
          # GitHub Actions has generous limits
          memory: 2G
          cpus: '4.0'
        reservations:
          memory: 1G
          cpus: '2.0'

  mailserver:
    # Minimal resources for GitHub Actions
    deploy:
      resources:
        limits:
          memory: 64M
          cpus: '0.25'

