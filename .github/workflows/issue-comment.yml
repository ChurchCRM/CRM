name: Auto-comment on Issues with Diagnostics Links

# Triggers on newly opened issues
on:
  issues:
    types: [opened]

jobs:
  comment-on-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Comment on bug reports
        uses: actions/github-script@v7
        with:
          script: |
            // Determine the issue type based on labels
            const labels = context.payload.issue.labels.map(label => label.name);
            const isBug = labels.includes('bug');
            
            let comment = '';
            
            if (isBug) {
              comment = `## ğŸ” Help Us Debug This Issue

Thank you for reporting this bug! To help us resolve it faster, please:

### 1ï¸âƒ£ **Collect Diagnostic Information**
See our comprehensive guide: **[Bug Reporting & Diagnostics](https://wiki.churchcrm.io/Bug-Reporting-and-Diagnostics)**

**Quick checklist:**
- [ ] Include your **ChurchCRM version** (Admin â†’ Dashboard or About)
- [ ] Include your **environment** (PHP, Database, hosting type)
- [ ] Attach **logs** from Admin â†’ System Logs (filter by ERROR/CRITICAL)
- [ ] Describe **steps to reproduce** the issue

### 2ï¸âƒ£ **Best Way to Report**
If you have access to your ChurchCRM installation:
1. Go to **Support** â†’ **Report an Issue** in your app
2. This automatically captures your system information and logs
3. Much faster for us to diagnose!

### 3ï¸âƒ£ **Format Your Report**
If reporting via GitHub:
- Wrap logs in \`\`\`code\`\`\` blocks
- [Redact sensitive info](https://wiki.churchcrm.io/Bug-Reporting-and-Diagnostics#privacy--security) (passwords, IPs, domains)
- Include screenshots if visual

### ğŸ“š Full Guide
See the complete guide for:
- How to access logs in cPanel
- SSH commands for self-hosted
- What information to collect
- Privacy guidelines

ğŸ‘‰ **[Bug Reporting & Diagnostics Guide](https://wiki.churchcrm.io/Bug-Reporting-and-Diagnostics)**

---
Thank you for helping make ChurchCRM better! ğŸ™`;
            } else if (labels.includes('question')) {
              comment = `## â“ Questions or Support?

Thanks for reaching out! For general questions and support:

- ğŸ“– **[Wiki Troubleshooting Guide](https://wiki.churchcrm.io/Troubleshooting)** - Most common issues
- ğŸ’¬ **[Gitter Chat](https://gitter.im/ChurchCRM/CRM)** - Community support
- ğŸ“š **[Documentation](https://wiki.churchcrm.io)** - Full user guide
- ğŸ› **[Bug Reports](https://github.com/ChurchCRM/CRM/issues?q=label:bug)** - Check if it's a known issue

For the fastest response, consider asking in our Gitter community chat!`;
            }
            
            if (comment) {
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            }
